<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flappy Square</title>
<link rel="stylesheet" href="../../assets/style.css" />
<style>
  .wrap { display:flex; flex-direction:column; align-items:center; gap:12px; }
  canvas { background: var(--elev-2); border-radius: 16px;
           border:1px solid color-mix(in srgb, var(--text), transparent 85%); }
  .hint { text-align:center; }
</style>
</head>
<body>
  <header class="site-header container">
    <a class="brand" href="../../">✨ Playground</a>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Flappy Square</h1>
      <p>Press Space / Tap to flap. Avoid the pipes.</p>
    </section>

    <div class="wrap">
      <canvas id="c" width="360" height="520"></canvas>
      <div class="hint muted">Space / Click / Tap to jump · R to restart</div>
      <button class="btn" id="restart">Restart</button>
    </div>
  </main>

  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;

    let bird, pipes, g, flap, score, alive;

    function reset(){
      bird = { x: 70, y: H/2, vy: 0, size: 20 };
      pipes = [];
      g = 0.35; flap = -6.5;
      score = 0; alive = true;
      spawnPipes();
    }

    function spawnPipes(){
      const gap = 120;
      const top = 60 + Math.random()*(H - 220);
      const w = 60;
      const x = W + 40;
      pipes.push({ x, w, top, gap });
    }

    function update(){
      if(!alive) return;
      // bird
      bird.vy += g;
      bird.y += bird.vy;

      // pipes
      for(const p of pipes){ p.x -= 2.5; }
      if(pipes[pipes.length-1].x < W - 180) spawnPipes();
      if(pipes[0].x + pipes[0].w < -10) { pipes.shift(); score++; }

      // collisions
      const p = pipes[0];
      const inX = bird.x + bird.size/2 > p.x && bird.x - bird.size/2 < p.x + p.w;
      const inY = bird.y - bird.size/2 < p.top || bird.y + bird.size/2 > p.top + p.gap;
      if (inX && inY) alive = false;
      if (bird.y - bird.size/2 < 0 || bird.y + bird.size/2 > H) alive = false;
    }

    function draw(){
      ctx.clearRect(0,0,W,H);

      // pipes
      ctx.fillStyle = '#7c9cff';
      for(const p of pipes){
        ctx.fillRect(p.x, 0, p.w, p.top);
        ctx.fillRect(p.x, p.top + p.gap, p.w, H - (p.top + p.gap));
      }

      // bird
      ctx.fillStyle = '#fff';
      ctx.fillRect(bird.x - bird.size/2, bird.y - bird.size/2, bird.size, bird.size);

      // score
      ctx.fillStyle = '#aaa';
      ctx.font = '16px Inter, sans-serif';
      ctx.fillText('Score: ' + score, 12, 22);

      if(!alive){
        ctx.fillStyle = '#fff';
        ctx.font = '24px Inter, sans-serif';
        ctx.fillText('Game Over', W/2 - 68, H/2 - 10);
        ctx.font = '14px Inter, sans-serif';
        ctx.fillText('Press R to restart', W/2 - 70, H/2 + 16);
      }
    }

    function loop(){
      update(); draw();
      requestAnimationFrame(loop);
    }

    function flapNow(){ if(alive) bird.vy = flap; }
    document.addEventListener('keydown', e => {
      if(e.code === 'Space') flapNow();
      if(e.key.toLowerCase() === 'r') reset();
    });
    canvas.addEventListener('mousedown', flapNow);
    canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); flapNow(); }, {passive:false});
    document.getElementById('restart').addEventListener('click', reset);

    reset(); loop();
  </script>
</body>
</html>
